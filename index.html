<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Cyber Security Blog Directory</title>

<style>
  body {
    margin: 0;
    padding: 16px;
    background: #faf8f2;
    font-family: "Inter", sans-serif;
    color: #222;
  }

  h2 {
    font-size: 1.4rem;
    text-align: center;
    margin-bottom: 20px;
    font-weight: 700;
  }

  .entry {
    padding: 14px 12px;
    margin-bottom: 12px;
    background: #ffffff;
    border-radius: 10px;
    border: 1px solid #ddd;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  }

  .line1 {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 6px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .reg {
    font-weight: 500;
    color: #444;
  }

  .line2 {
    font-size: 0.95rem;
  }

  a {
    font-weight: 600;
    text-decoration: none;
  }

  .link-live { color: #0a7a28; }
  .link-dead { color: #b40000; }

  /* Ultra mobile optimisation */
  @media (max-width: 480px) {
    body {
      padding: 10px;
    }
    .entry {
      padding: 12px 10px;
    }
    .line1 {
      font-size: 1rem;
    }
    .line2 {
      font-size: 0.9rem;
    }
  }

</style>
</head>

<body>

<h2>First Year Cyber Security (2025–2029)<br>Blog Directory</h2>

<div id="list"></div>

<script>
fetch("https://api.github.com/repos/andrewveda/blog-submissions/issues")
  .then(res => res.json())
  .then(issues => {
    const list = document.getElementById("list");

    issues.forEach(issue => {
      const body = issue.body;

      const nameMatch = body.match(/Your Full Name\s*\n([^\n]+)/);
      const regMatch = body.match(/Register Number\s*\n([^\n]+)/);
      const linkMatch = body.match(/Website Link\s*\n([^\n]+)/);

      const name = nameMatch ? nameMatch[1].trim() : "Unknown";
      const reg = regMatch ? regMatch[1].trim() : "Unknown";

      let rawLink = linkMatch ? linkMatch[1].trim() : "#";
      let link = rawLink.startsWith("http") ? rawLink : "https://" + rawLink;

      const entry = document.createElement("div");
      entry.className = "entry";

      entry.innerHTML = `
        <div class="line1">
          <span>${name}</span>
          <span class="reg">(${reg})</span>
        </div>
        <div class="line2"><span class="checking">Checking link…</span></div>
      `;

      list.appendChild(entry);

      const line2 = entry.querySelector(".checking");

      // Reject direct repo links
      const looksLikeRepo = link.includes("github.com/") && !link.includes("github.io");
      if (looksLikeRepo) {
        line2.innerHTML =
          `<span class="link-dead">Invalid: GitHub Repo Link ✖</span>`;
        return;
      }

      // Check if live
      fetch(link, { method: "HEAD" })
        .then(r => {
          if (r.ok) {
            line2.innerHTML =
              `<a href="${link}" target="_blank" class="link-live">Visit Site ✔</a>`;
          } else {
            line2.innerHTML =
              `<span class="link-dead">Not Live ✖</span>`;
          }
        })
        .catch(() => {
          line2.innerHTML =
            `<span class="link-dead">Invalid URL ✖</span>`;
        });
    });
  });
</script>

</body>
</html>