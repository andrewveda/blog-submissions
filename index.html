<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cyber Security Blog Directory</title>

<style>
  body {
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg,#f7f5ef,#ece8df);
    font-family: "Inter", sans-serif;
    color: #222;
  }

  h2 {
    text-align: center;
    margin-bottom: 15px;
    font-size: 1.5rem;
    font-weight: 700;
  }

  #controls {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }

  select {
    padding: 10px 14px;
    border-radius: 12px;
    border: 1px solid #aaa;
    font-size: 1rem;
    background: white;
    cursor: pointer;
  }

  .entry {
    padding: 16px 14px;
    margin-bottom: 14px;
    background: rgba(255,255,255,0.7);
    border-radius: 14px;
    border: 1px solid #dcdcdc;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    transition: transform 0.15s, box-shadow 0.15s;
  }

  .entry:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.14);
  }

  .line1 {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .reg {
    font-weight: 500;
    color: #555;
  }

  .line2 {
    font-size: 0.95rem;
  }

  .link-live { color: #0a7a28; font-weight: 600; text-decoration: none; }
  .link-dead { color: #b40000; font-weight: 600; }

</style>
</head>

<body>

<h2>First Year Cyber Security (2025–2029)<br>Blog Directory</h2>

<div id="controls">
  <select id="sortSelect">
    <option value="nameAsc">Sort: Name A → Z</option>
    <option value="nameDesc">Sort: Name Z → A</option>
  </select>
</div>

<div id="list"></div>

<script>
let entriesData = [];

function renderList() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  entriesData.forEach(e => {
    const card = document.createElement("div");
    card.className = "entry";
    card.innerHTML = `
      <div class="line1">
         ${e.name} <span class="reg">(${e.reg})</span>
      </div>
      <div class="line2">${e.statusHTML}</div>
    `;
    list.appendChild(card);
  });
}

function sortData(type) {
  if (type === "nameAsc") entriesData.sort((a,b)=>a.name.localeCompare(b.name));
  if (type === "nameDesc") entriesData.sort((a,b)=>b.name.localeCompare(a.name));
  if (type === "regAsc") entriesData.sort((a,b)=>a.reg.localeCompare(b.reg));
  if (type === "regDesc") entriesData.sort((a,b)=>b.reg.localeCompare(a.reg));
  if (type === "liveFirst") entriesData.sort((a,b)=>b.isLive - a.isLive);
  if (type === "deadFirst") entriesData.sort((a,b)=>a.isLive - b.isLive);

  renderList();
}

document.getElementById("sortSelect").addEventListener("change", e => {
  sortData(e.target.value);
});

function processIssues(issues) {
  const promises = issues.map(issue => {
    const body = issue.body || "";

    const name = (body.match(/Your Full Name\s*\n([^\n]+)/)?.[1] || "Unknown").trim();
    const reg = (body.match(/Register Number\s*\n([^\n]+)/)?.[1] || "Unknown").trim();
    const rawLink = (body.match(/Website Link\s*\n([^\n]+)/)?.[1] || "#").trim();

    let link = rawLink.startsWith("http") ? rawLink : "https://" + rawLink;

    const looksRepo = link.includes("github.com/") && !link.includes("github.io");

    if (looksRepo) {
      return Promise.resolve({
        name, reg, isLive: 0,
        statusHTML: `<span class="link-dead">Invalid: GitHub Repo Link ✖</span>`
      });
    }

    return fetch(link, { method: "HEAD" })
      .then(r => ({
        name, reg,
        isLive: r.ok ? 1 : 0,
        statusHTML: r.ok
          ? `<a href="${link}" target="_blank" class="link-live">Visit Site ✔</a>`
          : `<span class="link-dead">Not Live ✖</span>`
      }))
      .catch(() => ({
        name, reg, isLive: 0,
        statusHTML: `<span class="link-dead">Invalid URL ✖</span>`
      }));
  });

  Promise.all(promises).then(results => {
    entriesData = results;
    sortData("nameAsc");
  });
}

// Fetch GitHub Issues
fetch("https://api.github.com/repos/andrewveda/blog-submissions/issues")
  .then(res => res.json())
  .then(data => {
    if (Array.isArray(data) && data.length) {
      processIssues(data);
    } else {
      throw new Error("No data, using fallback");
    }
  })
  .catch(() => {
    // MASSIVE fallback dataset (sample)
    const fallback = [];
    for (let i=1; i<=50; i++) {
      fallback.push({
        name: "Student " + i,
        reg: "CS25" + String(i).padStart(3,"0"),
        isLive: i % 2,
        statusHTML: i % 2
          ? `<a href="https://example${i}.com" class="link-live" target="_blank">Visit Site ✔</a>`
          : `<span class="link-dead">Not Live ✖</span>`
      });
    }

    entriesData = fallback;
    renderList();
  });
</script>

</body>
</html>
